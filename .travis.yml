language: python
cache: pip
sudo: false
env:
- MARSHMALLOW_VERSION="==3.0.0"
- MARSHMALLOW_VERSION=""
python:
- '3.6'
- '3.8'
before_install:
- travis_retry pip install codecov
install:
- travis_retry pip install -U .
- travis_retry pip install -U -r dev-requirements.txt
- travis_retry pip install -U --pre marshmallow"$MARSHMALLOW_VERSION"
before_script:
- flake8 flask_apispec
script: py.test
after_success: codecov
jobs:
  include:
  - stage: PyPI Release
    if: tag IS present
    python: "3.8"
    env: []
    # Override install, and script to no-ops
    before_install: true
    install:
    - travis_retry pip install -U .
    - travis_retry pip install -r dev-requirements.txt
    before_script: true
    script: echo "Releasing to PyPI..."
    after_success: true
    before_deploy: invoke install
    deploy:
      provider: pypi
      user: sloria
      password:
        secure: P@ssw0rD!123
      on:
        tags: true
      distributions: "sdist bdist_wheel"
      skip_cleanup: true
